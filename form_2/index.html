<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Form</title>
    <%
        ac = Random(1,999);
        var Learnings = {};
        var Orgs = XQuery("sql: SELECT CAST(id AS VARCHAR) AS id, name FROM education_orgs WHERE name != ''");

        for (org in Orgs) {
            Learnings[org.id] = XQuery('sql: SELECT CAST(id AS VARCHAR) AS id, name FROM education_methods WHERE education_org_id =' + Int(org.id));
        }

    %>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="http://<%=Request.UrlHost%>/portal/scripts/bootstrap/bootstrap-select/css/animate.css">
    <link rel="stylesheet" href="http://<%=Request.UrlHost%>/portal/scripts/bootstrap/bootstrap-select/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://<%=Request.UrlHost%>/portal/scripts/bootstrap/bootstrap-select/css/bs.min.css">
    <link rel='stylesheet' href='http://<%=Request.UrlHost%>/portal/scripts/jquery-ui-1.12.1/jquery-ui.min.css'>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <script type="text/javascript" src="http://<%=Request.UrlHost%>/portal/scripts/jquery-3.4.0.min.js?<%=ac%>"></script>
    <script type="text/javascript" src="http://<%=Request.UrlHost%>/portal/scripts/popper.min.js?<%=ac%>"></script>
    <script type="text/javascript" src="http://<%=Request.UrlHost%>/portal/scripts/bootstrap/js/bootstrap.min.js?<%=ac%>"></script>
    <script src="http://<%=Request.UrlHost%>/portal/scripts/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="http://<%=Request.UrlHost%>/portal/scripts/bootstrap/bootstrap-select/bootstrap-select.min.js?<%=ac%>"></script>
    <script>

        var Orgs = <%=tools.object_to_text(Orgs, 'json')%>;        
        var Learnings = <%=tools.object_to_text(Learnings, 'json')%>;

        $(document).ready(function(){

            for (i in Orgs) {
                $('<option>', {value: Orgs[i].id}).append( Orgs[i].name ).appendTo('#orgs');
            }

            $('#orgs').change(function(){

                $("#learnings").html("<option selected disabled value='0'>Выберите из списка</option>");

                for ( i in Learnings[$(this).val()] ) {
                    $('<option>', {value: Learnings[$(this).val()][i].id}).append( Learnings[$(this).val()][i].name ).appendTo('#learnings');
                }

                $("#learnings").selectpicker('refresh');
            });

          });

        $( function() {
        var dateFormat = "mm/dd/yy",
        from = $( "#from" )
            .datepicker({
            defaultDate: "+1w",
            changeMonth: true,
            numberOfMonths: 3
            })
            .on( "change", function() {
            to.datepicker( "option", "minDate", getDate( this ) );
            }),
            to = $( "#to" ).datepicker({
                defaultDate: "+1w",
                changeMonth: true,
                numberOfMonths: 3
            })
            .on( "change", function() {
            from.datepicker( "option", "maxDate", getDate( this ) );
            });

            function getDate( element ) {
            var date;
            try {
                date = $.datepicker.parseDate( dateFormat, element.value );
            } catch( error ) {
                date = null;
            }

            return date;
        }
        } );
        function getEvents(id) {
        $('#orgs').html('');
        $.ajax({
        url: "http://<%=Request.UrlHost%>/portal/reports/event_results/ajax.html"
        ,method: 'POST'
        ,data: {orgid: id}
        ,success: function(e) {
            let elems = JSON.parse(e);

            if (elems.lenth = 0) {
            alert('Мероприятия не найдены')
            return false;
            }

            for ( i in elems ) {
            $('<option>', {value: elems[i].id}).append( elems[i].name ).appendTo('#events');
            }

            $('#events').selectmenu({
            change: function(event, ui) {
                //getEvents(ui.item.value);
            }
            });

            //$('#events').fadeIn(500);
        }
        ,error: function(a,b,c) {
            console.log(a + b + c);
        }
    })
}
    </script>
</head>
<body style="background-color: #4c1e87;">
<div class="col-sm-10 col-sm-offset-1">
    <div style="min-height: 20px; padding: 50px; margin-top: 135px; background-color: #fff; border: 1px solid transparent; border-radius: 20px;">
    <form role="form" autocomplete='off' id="contactForm" data-toggle="validator" class="shake">
        <div class="row">
            <div class="col-sm-13 col-sm-offset-5">
                <h3 style="text-transform: uppercase; font-weight: bold; font-family: 'Roboto', sans-serif;">Отчет по результатам</h3>
            </div>
            <div class="form-group col-sm-12">
                <label for="date" class="h5" style="text-transform: uppercase; font-family: 'Montserrat', sans-serif;">Учебный центр</label>
                <select class="selectpicker" data-live-search="true" id="orgs" data-width="100%">
                </select>
            </div>
            <div class="form-group col-sm-12">
                <label for="date" class="h5" style="text-transform: uppercase; font-family: 'Montserrat', sans-serif;">Учебная программа</label>
                <select class="selectpicker" data-live-search="true" id="learnings" data-width="100%">
                    <option selected disabled value='0'>Выберите из списка</option>
                </select>
            </div>
            <div class="form-group col-sm-12">
                <input type="checkbox" class="form-check-input" id="exampleCheck1">
                <label for="events" class="h5" style="text-transform: uppercase; font-family: 'Montserrat', sans-serif;">Не учитывать уволенных сотрудников</label>
            </div>
            <div class="form-group col-sm-6">
                    <label for="date" class="h5" style="text-transform: uppercase; font-family: 'Montserrat', sans-serif;">Дата с:</label>
                <input type="date" class="form-control" onkeyup="check();" id="birth_date" placeholder="Дата с">
            </div>
            <div class="form-group col-sm-6">
                <label for="date" class="h5" style="text-transform: uppercase; font-family: 'Montserrat', sans-serif;">По:</label>
                <input type="date" class="form-control" onkeyup="check();" id="birth_date" placeholder="По">
            </div>
            <div class="form-group col-sm-12">
                <button type="button" id="submit" class="btn btn-success btn-m pull-right" style="border: 3px solid #fff; border-radius: 5px;">Экспорт в Excel</button>
                <button type="button" id="submit" class="btn btn-info btn-m pull-right" style="border: 3px solid #fff; border-radius: 5px;">Сформировать</button>
            </div>
            <label for="events" class="h6" style="padding: 10px; margin: 15px; font-family: 'Montserrat', sans-serif; font-weight: bold;">
                <p>Для формирования отчета необходимо выбрать учебный центр (фильтр "Учебный центр") и период, за который осуществлять проверку (фильтр "Дата").</p>
                <p>Фильтр "Учебная программа" выбирается при необходимости.Отчет будет формировать по всем сотрудникам, обучавшимся в выбранном УЦ за указанный период.</p>  
            </label>
        </div>
    </form>
    </div>
</div>
</body>
<script type="text/javascript" src="http://<%=Request.UrlHost%>/portal/scripts/validator.min.js?<%=ac%>" async='false'></script>
<script type="text/javascript" src="http://<%=Request.UrlHost%>/portal/scripts/form-scripts.js?<%=ac%>" async='false'></script>
</html>